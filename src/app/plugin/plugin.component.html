<app-splash
		[appname]="appname"
		[duration]="2000"
		[image]="visual"
		[description]="claim"></app-splash>


<div class="background-form" [style.background-image]="'url('+background+')'">
	<div class="popup-form background-component mat-elevation-z18" style="max-width:800px;width:100%;min-height: 96vh;margin:0;padding: 10px;" >

		<mat-icon style="color:lightgray;display: block;position: absolute;right:10px;top:5px;opacity: 0.5;cursor: pointer;z-index: 10;"
		          title="Passer en mode avancé pour accèder à des options supplémentaire"
		          (click)="switch_mode()">
			person_add
		</mat-icon>

		<div class="titleform" *ngIf="appname">{{appname || ""}}</div>

		<app-tuto  label="L'application utilise la clé privé d'un wallet pour distribuer les gains.
		 Vous pouvez utilisez un wallet dédié à cet usage (conseiller) ou fournir la clé privée d'un wallet existant (qui sera cryptée avant usage)."></app-tuto>

		<div style="width: 100%;text-align: center;" *ngIf="code_to_insert==''">


			<div style="width: 100%;" class="expansion-content-left">
				<app-input label="Blockchain / Réseau" [options]="networks" value_type="list" width="160px"
				           *ngIf="airdrop.dealer_wallet==''"
				           [value]="network" (valueChange)="update_network($event)"></app-input>

				<app-input label="Wallet de distribution" width="250px"
				           help="Wallet crypté contenant la monnaie a distribuer"
				           title="Ce wallet contient la somme à distribuer"
				           (cancel)="restart()" (validate)="dealer_wallet_validate()"
				           [value]="airdrop.dealer_wallet" (valueChange)="update_dealer_wallet($event)" value_type="text">
				</app-input>

				<app-link [content]="address" [network]="network.value" *ngIf="address" icon="travel_explore" style="margin-left: 15px;"></app-link>

				<div *ngIf="airdrop.dealer_wallet==''" class="expansion-content-left" style="width:350px;">
					<app-upload-file style="margin-top:-16px;" [zone]="true"
					                 extensions=".json" (uploaded)="keystore_upload($event)"
					                 height="50px" icon="file_upload"></app-upload-file>

					<button mat-icon-button
					        style="margin-top: -10px;"
					        title="Créer un wallet pour l'opération"
					        (click)="create_account()">
						<mat-icon>add_circle</mat-icon>
					</button>

					<button mat-icon-button
					        [disabled]="airdrop.dealer_wallet!=''"
					        style="margin-top: -10px;"
					        title="Utiliser un wallet existant"
					        (click)="encrypt_key()">
						<mat-icon>key</mat-icon>
					</button>

					<app-input label="Wallets public"
					           *ngIf="airdrop && airdrop.network!.indexOf('devnet')>-1 && airdrop.dealer_wallet==''"
					           value_type="list" width="140px"
					           [options]="public_wallets" (valueChange)="set_public_wallet($event)"></app-input>

				</div>




				<div *ngIf="qrcode_wallet.length>0" style="width: 100%;text-align: center;margin-bottom:30px;">
					<div class="mat-body-2">Envoyer la somme à distribuer sur votre nouvelle adresse puis utiliser le bouton refresh</div><br>
					<img [src]="qrcode_wallet" title="Cliquer pour copier l'adresse de réception"
					     style="width: 150px;margin:10px;cursor: copy;" [cdkCopyToClipboard]="address"><br>
					<button mat-raised-button (click)="qrcode_wallet=''">Annuler</button>
					<button mat-raised-button (click)="save_airdrop()">Refresh</button>
				</div>
			</div>

			<div style="width: 95%;margin-left: 5px;" *ngIf="address!=''">
				<app-token-selector label="Monnaie à distribuer"
				                    [owner]="address"
				                    [network]="airdrop.network" [show_detail]="false"
				                    (endSearch)="onEndSearch($event)"
				                    (valueChange)="update_token($event);"></app-token-selector>
			</div>

			<br>

			<div style="width: 100%;display: flex;flex-wrap: wrap;align-items: center;justify-content:space-around;margin-left: -5px;" *ngIf="airdrop!.token.identifier">

				<app-input label="Montant versé" width="135px" style="display: inline-block;"
				           [value]="airdrop.amount" [min]="0" [max]="airdrop.limit_by_day"
				           [unity]="airdrop.token.name"
				           (valueChange)="airdrop.amount=$event"
				           value_type="number"></app-input>

				<app-input label="Maximum / jour" width="135px"  style="display: inline-block;"
				           [value]="airdrop.limit_by_day" [min]="0"
				           [unity]="airdrop.token.name"
				           (valueChange)="airdrop.limit_by_day=$event"
				           value_type="number"></app-input>

				<app-input label="Limite par wallet" width="135px"  style="display: inline-block;"
				           [value]="airdrop.limit_by_wallet" [min]="0"
				           [unity]="airdrop.token.name"
				           (valueChange)="airdrop.limit_by_wallet=$event"
				           value_type="number"></app-input>
			</div>

			<mat-expansion-panel *ngIf="airdrop!.token.identifier">
				<mat-expansion-panel-header>Process d'authentification</mat-expansion-panel-header>
				<app-input value_type="boolean" [value]="airdrop.force_authent"
				           help="Dans le cas contraire, l'adresse de l'utilisateur est enregistré sous forme de cookie donc demander à la première visite uniquement"
				           (valueChange)="update_authent($event)"
				           label="Forcer l'authentification à chaque visite"></app-input>
				<br>

				<p style="text-align: left;" class="mat-body-1">
					L'authentification est possible via :<br>
					<app-input label="Wallet connect" [value]="connexion.wallet_connect" (valueChange)="connexion.wallet_connect=$event" value_type="boolean"></app-input>
					<app-input label="Extension Chrome" [value]="connexion.extension_wallet" (valueChange)="connexion.extension_wallet=$event" value_type="boolean"></app-input>
					<app-input label="Email / Google (entrainant une création de wallet)" [value]="connexion.email" (valueChange)="connexion.email=$event" value_type="boolean"></app-input>

				</p>

			</mat-expansion-panel>


			<button mat-raised-button color="primary" (click)="save_airdrop()" *ngIf="airdrop.token.identifier">
				Suivant
			</button>

		</div>

		<mat-tab-group *ngIf="code_to_insert!=''" style="text-align: center;width:100%;margin-left: -10px;" (selectedTabChange)="set_into_message($event)">

			<mat-tab label="Affiliation" *ngIf="false">
				<div class="explain-bloc mat-body-2">{{intro_tab}}</div>

				<br>
				<app-input label="Votre lien à proposer" [value]="affiliate_url" (valueChange)="affiliate_url=$event"
				           maxwidth="400px"
				           value_type="text"></app-input>
				<br>

				<button mat-raised-button (click)="add_affiliate_link()">Ajouter</button>
			</mat-tab>

			<mat-tab label="Visiteurs">
				<div style="width: 100%;text-align: center;">
					<div class="explain-bloc mat-body-2">{{intro_tab}}</div>


					<mat-expansion-panel style="max-width: 500px;display: inline-block;">
						<mat-expansion-panel-header>Options avancées</mat-expansion-panel-header>
						<br>
						<app-input label="Pourcentage de visites récompensées" unity="%" width="350px"
						           help="Pour 100 visites, seule une partie obtient la récompense"
						           [value]="airdrop.random" [min]="1" [max]="100" value_type="slide"
						           (valueChange)="airdrop.random=$event;">
						</app-input>

						<app-input label="Delai avant versement" unity="sec" width="350px"
						           help="Si le visiteur quitte trop top la page il n'est pas récompensé"
						           [value]="airdrop.authent_delay" [min]="0" [max]="60" value_type="slide"
						           (valueChange)="airdrop.authent_delay=$event;">
						</app-input>

						<div class="expansion-content-left" *ngIf="user.advance_mode" style="width: 100%;">
							<app-input label="Date de début de campagne" value_type="text" width="180px"
							           [value]="airdrop.dtStart" (valueChange)="airdrop.dtStart=$event;save_airdrop()"></app-input>

							<app-input label="Date de fin" value_type="text" width="180px"
							           [value]="airdrop.dtEnd" (valueChange)="airdrop.dtEnd=$event"></app-input>

						</div>



						<app-input label="Informer le visiteur du versement" value_type="boolean"
						           [value]="airdrop.show_deal" (valueChange)="airdrop.show_deal=$event;save_airdrop()"></app-input>


						<br>

					</mat-expansion-panel>

					<div class="mat-elevation-z4 mat-body-2"  [cdkCopyToClipboard]="code_to_insert"
					     title="Cliquer pour copier le contenu"
					     style="cursor: copy;padding:5px;max-height:30vh;max-width:550px;width:87%;display: inline-block;margin: 10px;text-align: left;opacity: 0.7;overflow: hidden;">
						{{code_to_insert}}
					</div>
				</div>
			</mat-tab>

			<mat-tab label="Lien récompensé">
				<div class="explain-bloc mat-body-2">{{intro_tab}}</div>
				<br>
				<div *ngIf="short_url.length==0" style="width:90%;max-width: 600px;display: inline-block;">
					<app-input label="Rediriger vers" value_type="text"
					           help="Adresse du site web vers lequel le visiteur est dirigé"
					           [value]="redirect" (valueChange)="redirect=$event;"></app-input>

					<br>
					<button mat-raised-button (click)="eval_redirect()"
					        title="Fabrique le lien court à partager pour activer l'airdrop"
					        color="primary">Créer le lien</button>

					<br><br>

					<mat-expansion-panel style="max-width: 500px;display: inline-block;">
						<mat-expansion-panel-header>Options avancées</mat-expansion-panel-header>
						<br>
						<app-input label="Message pour la redirection" value_type="text"
						           [value]="redirect_message" (valueChange)="redirect_message=$event;"></app-input>
						<br>
						<app-input label="Pourcentage de visites récompensées" unity="%" width="350px"
						           help="Pour 100 visites, seule une partie obtient la récompense"
						           [value]="airdrop.random" [min]="1" [max]="100" value_type="slide"
						           (valueChange)="airdrop.random=$event;">
						</app-input>
					</mat-expansion-panel>

				</div>


				<div *ngIf="short_url.length>0">
					{{short_url}}<br><br>

					<img [src]="url_qrcode" style="width: 150px;height:150px;">
					<br><br>
					<button mat-raised-button (click)="share_url(short_url,intro_tab)">Partager</button>
					<button mat-raised-button (click)="open_test(short_url)">Tester</button>
					<button mat-raised-button (click)="modify()">Modifier</button>
				</div>
			</mat-tab>

			<mat-tab label="Lien direct" style="text-align: center;">
				<div class="explain-bloc mat-body-2">{{intro_tab}}</div>
				<br>

				<app-input label="Adresse web de la banque" width="350px" style="display: inline-block;"
				           [value]="url_bank" (valueChange)="url_bank=$event"></app-input>
				<br>

				<div *ngIf="url_bank!=''">
					<br><br>
					<app-link [content]="url">Lien pour le rechargement de {{airdrop.token.name}}<br></app-link>
					<br><br>
					<button mat-raised-button (click)="share_url(url,intro_tab)">Partager</button>
					<button mat-raised-button (click)="open_test(url)">Tester</button>
					<br><br>

					<mat-expansion-panel style="max-width: 500px;display: inline-block;">
						<mat-expansion-panel-header>Options avancées</mat-expansion-panel-header>
						<app-genlink [properties]="link_properties" [show_command_panel]="false"
						             (update)="update_properties($event)"></app-genlink>
					</mat-expansion-panel>
				</div>

			</mat-tab>


		</mat-tab-group>

		<div style="width:100%;text-align: center;position: absolute;bottom:10px;">
			<button mat-raised-button *ngIf="code_to_insert!=''"
			        (click)="code_to_insert=''">Modifier</button>

			<button mat-raised-button *ngIf="code_to_insert!=''"
			        (click)="restart()">Nouveau</button>

		</div>


	</div>
</div>
