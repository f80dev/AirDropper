<app-splash
		[appname]="appname"
		[duration]="2000"
		[image]="visual"
		[description]="claim"></app-splash>


<div class="background-form" [style.background-image]="'url('+background+')'">
	<div class="popup-form background-component mat-elevation-z18" style="max-width:400px;width:100%;min-height: 96vh;margin:0;padding: 10px;" >

		<mat-icon style="color:lightgray;display: block;position: absolute;right:10px;top:5px;opacity: 0.5;cursor: pointer;z-index: 10;"
		          title="Passer en mode avancé pour accèder à des options supplémentaire"
		          (click)="switch_mode()">
			person_add
		</mat-icon>

		<div class="titleform" *ngIf="appname">{{appname || ""}}</div>

		<app-tuto label="L'application utilise la clé privé d'un wallet pour distribuer les gains.
		 Vous pouvez utilisez un wallet dédié à cet usage (conseiller) ou fournir la clé privée d'un wallet existant (qui sera cryptée avant usage)"></app-tuto>

		<div *ngIf="code_to_insert==''" style="width: 100%;text-align: left;">
			<div class="expansion-content-left">
				<app-input label="Wallet crypté" width="270px"
				           title="Ce wallet contient la somme à distribuer"
				           [value]="airdrop.dealer_wallet" (valueChange)="airdrop.dealer_wallet=$event" value_type="text">
				</app-input>

				<button mat-icon-button
				        [disabled]="airdrop.dealer_wallet!=''"
				        style="margin-top: -10px;"
				        title="Créer un wallet pour l'opération"
				        (click)="create_account()">
					<mat-icon>add_circle</mat-icon>
				</button>

				<button mat-icon-button
				        [disabled]="airdrop.dealer_wallet!=''"
				        style="margin-top: -10px;"
				        title="Utiliser un wallet existant"
				        (click)="encrypt_key()">
					<mat-icon>key</mat-icon>
				</button>

				<div *ngIf="qrcode_wallet.length>0" style="width: 100%;text-align: center;margin-bottom:30px;">
					<div class="mat-body-2">Envoyer le token à distribuer sur votre nouvelle adresse:</div><br>
					<img [src]="qrcode_wallet" title="Cliquer pour copier l'adresse de réception"
					     style="width: 150px;margin:10px;cursor: copy;" [cdkCopyToClipboard]="address"><br>
					<button mat-raised-button (click)="qrcode_wallet=''">Effacer</button>
					<button mat-raised-button (click)="save_airdrop()">Refresh</button>
				</div>

			</div>



			<app-input label="Blockchain / Réseau" [options]="networks" value_type="list" width="97%"
			           [value]="airdrop.network" (valueChange)="update_network($event)"></app-input>

			<div style="width: 95%;margin-left: 15px;">
				<app-token-selector label="Monnaie à distribuer"
				                    [filter]="address"
				                    [network]="airdrop.network.value" [show_detail]="false"
				                    (valueChange)="airdrop.token=$event"></app-token-selector>
			</div>

			<br>


			<mat-expansion-panel style="margin-top: 10px;margin-left: -5px;">
				<mat-expansion-panel-header>Conditions</mat-expansion-panel-header>
				<div style="display: inline-flex;width:100%;">
					<app-input label="Montant / visite" width="175px"
					           [value]="airdrop.amount" (valueChange)="airdrop.amount=$event"
					           value_type="number"
					></app-input>

					<app-input label="Maximum / jour" width="175px"
					           [value]="airdrop.limit_by_day" (valueChange)="airdrop.limit_by_day=$event"
					           value_type="number"
					></app-input>

				</div>
				<br>
				<app-input label="Pourcentage de chance de gagner" unity="%"
				           [value]="airdrop.random" [min]="1" [max]="100" value_type="slide"
				           (valueChange)="airdrop.random=$event">
				</app-input>

				<br>
				<app-input label="Delai avant versement" unity="sec"
				           help="Si le visiteur quitte trop top la page il n'est pas récompensé"
				           [value]="airdrop.authent_delay" [min]="0" [max]="60" value_type="slide"
				           (valueChange)="airdrop.authent_delay=$event">
				</app-input>

				<app-input label="Informer le visiteur du versement" value_type="boolean"
				           [value]="airdrop.show_deal" (valueChange)="airdrop.show_deal=$event"></app-input>

				<br>
				<div class="expansion-content-left" *ngIf="user.advance_mode" style="width: 100%;">
					<app-input label="Date de début de campagne" value_type="text" width="180px"
					           [value]="airdrop.dtStart" (valueChange)="airdrop.dtStart=$event"></app-input>

					<app-input label="Date de fin" value_type="text" width="180px"
					           [value]="airdrop.dtEnd" (valueChange)="airdrop.dtEnd=$event"></app-input>

				</div>

				<div style="width: 100%;text-align: center;margin-top: 50px;">
					<button mat-raised-button color="primary"
					        [disabled]="airdrop.dealer_wallet=='' || airdrop.token=={}"
					        (click)="save_airdrop()">Valider</button>

				</div>
			</mat-expansion-panel>



		</div>

		<mat-tab-group *ngIf="code_to_insert!=''" style="text-align: center;width:450px;">

			<mat-tab label="Code HTML">
				<div style="width:80%px;display: inline-block;margin:30px;">
					Insérer le code suivant dans votre page pour
					que chaque visiteur recoive {{airdrop.amount}} {{airdrop.token.name}}
					dans la limite de {{airdrop.limit_by_day}} par jour
				</div>
				<br>

				<div class="mat-elevation-z4 mat-body-2"  [cdkCopyToClipboard]="code_to_insert"
				     style="cursor: copy;padding:15px;max-width: 550px;display: inline-block;margin: 30px;text-align: left;opacity: 0.7;;overflow: hidden;">
					{{code_to_insert}}
				</div>
			</mat-tab>

			<mat-tab label="Lien à insérer">
				<div style="width:80%;display: inline-block;margin:30px;">
					Partager le lien suivant pour permettre à celui qui l'ouvre
					de recevoir {{airdrop.amount}} {{airdrop.token.name}}
					dans la limite de {{airdrop.limit_by_day}} par jour
				</div>
				<br>

				<button mat-raised-button (click)="share_url()">Partager</button>
				<button mat-raised-button (click)="open_test()">Tester</button>

				<br><br>
					<app-genlink [properties]="link_properties" [show_command_panel]="false"
					             (update)="update_properties($event)"></app-genlink>


			</mat-tab>

			<mat-tab label="Code Angular">

			</mat-tab>

		</mat-tab-group>

		<br>
		<button mat-raised-button *ngIf="code_to_insert!=''"
		        (click)="code_to_insert=''">Modifier</button>

		<button mat-raised-button *ngIf="code_to_insert!=''"
		        (click)="restart()">Nouveau</button>


	</div>
</div>
